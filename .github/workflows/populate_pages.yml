name: Populate Pages and Routing
on: [workflow_dispatch]

jobs:
  populate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Populate Main Menu Page
        run: |
          cat << 'EOF' > src/pages/MainMenu.tsx
          import React from 'react';

          export function MainMenu() {
            return (
              <div className="min-h-screen bg-[#0a0a0b] flex flex-col items-center justify-center text-[#f5f5f0] p-6">
                <div className="max-w-md w-full text-center space-y-8 animate-in fade-in duration-1000">
                  <h1 className="text-5xl font-lora font-semibold tracking-tight">Lifespring Chronicles</h1>
                  <p className="text-lg text-[#b8b8a8] font-inter">Every choice echoes. Every life matters.</p>
                  
                  <div className="flex flex-col gap-4 mt-12">
                    <button onClick={() => window.location.href='/new-game'} className="w-full bg-[#f4b8a8] text-[#0a0a0b] py-4 rounded-lg font-medium text-lg hover:scale-[1.02] transition-transform">
                      Begin a New Life
                    </button>
                    <button disabled className="w-full bg-[#1a1a1c] border border-[#3a3a3d] text-[#6a6a62] py-4 rounded-lg font-medium text-lg cursor-not-allowed">
                      Load Saved Life
                    </button>
                  </div>
                </div>
              </div>
            );
          }
          EOF

      - name: Populate New Game Page
        run: |
          cat << 'EOF' > src/pages/NewGame.tsx
          import React from 'react';

          export function NewGame() {
            return (
              <div className="min-h-screen bg-[#0a0a0b] flex flex-col items-center justify-center p-6">
                <div className="max-w-2xl w-full bg-[#1a1a1c] border border-[#3a3a3d] rounded-xl p-8 text-center space-y-6">
                  <h2 className="text-3xl font-lora text-[#f5f5f0]">The Beginning</h2>
                  <p className="text-lg text-[#b8b8a8] font-lora leading-relaxed">
                    You are about to be born into a procedurally generated life. Your starting circumstances, family wealth, and inherent temperament will be determined by chance. From there, your choices will shape your legacy.
                  </p>
                  <button onClick={() => window.location.href='/game'} className="mt-8 px-8 py-3 bg-[#5ba3ff] text-[#0a0a0b] rounded-lg font-medium hover:scale-[1.02] transition-transform">
                    Take Your First Breath
                  </button>
                </div>
              </div>
            );
          }
          EOF

      - name: Populate Main Game Page
        run: |
          cat << 'EOF' > src/pages/Game.tsx
          import React from 'react';
          import { useGameStore } from '../store/gameStore';
          import { StatBar } from '../components/game/StatBar';
          import { EventCard } from '../components/game/EventCard';

          export function Game() {
            const { gameState, currentEvent, applyStatDeltas, progressAge } = useGameStore();

            const handleChoice = (choiceIndex: number) => {
              if (currentEvent && currentEvent.choices[choiceIndex].statDeltas) {
                applyStatDeltas(currentEvent.choices[choiceIndex].statDeltas!);
                progressAge(1);
              }
            };

            return (
              <div className="min-h-screen bg-[#0a0a0b] text-[#f5f5f0] flex flex-col md:flex-row">
                <aside className="w-full md:w-72 bg-[#1a1a1c] border-r border-[#3a3a3d] p-6 flex flex-col gap-6 overflow-y-auto">
                  <div className="text-center pb-4 border-b border-[#3a3a3d]">
                    <h2 className="text-xl font-mono text-[#b8b8a8]">Age: {gameState?.current_age || 0}</h2>
                    <span className="text-sm text-[#f4b8a8] uppercase tracking-wider">Stage {gameState?.current_stage || 0}</span>
                  </div>
                  <div className="flex flex-col gap-2">
                    <StatBar statName="Health" value={gameState?.stats.health || 75} color="bg-red-500" />
                    <StatBar statName="Happiness" value={gameState?.stats.happiness || 50} color="bg-yellow-500" />
                    <StatBar statName="Wealth" value={gameState?.stats.wealth || 50} color="bg-green-500" />
                    <StatBar statName="Intelligence" value={gameState?.stats.intelligence || 50} color="bg-blue-500" />
                  </div>
                </aside>
                
                <main className="flex-1 p-6 md:p-12 flex items-center justify-center">
                  {currentEvent ? (
                    <EventCard 
                      event={currentEvent} 
                      currentAge={gameState?.current_age || 0}
                      currentStage={gameState?.current_stage || 0}
                      onChoiceSelect={handleChoice}
                    />
                  ) : (
                    <div className="text-center text-[#6a6a62] animate-pulse">
                      Awaiting life events...
                    </div>
                  )}
                </main>
              </div>
            );
          }
          EOF

      - name: Populate App Router
        run: |
          cat << 'EOF' > src/App.tsx
          import React from 'react';
          import { MainMenu } from './pages/MainMenu';
          import { NewGame } from './pages/NewGame';
          import { Game } from './pages/Game';

          function App() {
            const path = window.location.pathname;

            if (path === '/new-game') return <NewGame />;
            if (path === '/game') return <Game />;
            
            return <MainMenu />;
          }

          export default App;
          EOF

      - name: Commit and Push Updates
        run: |
          git config --global user.name "GitHub Actions Builder"
          git config --global user.email "actions@github.com"
          git add src/pages/MainMenu.tsx src/pages/NewGame.tsx src/pages/Game.tsx src/App.tsx
          git commit -m "Injected Task 0.1 routing and Phase 1 pages"
          git push
