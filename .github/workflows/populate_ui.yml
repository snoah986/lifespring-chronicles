name: Populate UI Components
on: [workflow_dispatch]

jobs:
  populate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Populate StatBar Component (Task 1.4)
        run: |
          cat << 'EOF' > src/components/game/StatBar.tsx
          import React from 'react';

          interface StatBarProps {
            statName: string;
            value: number;
            maxValue?: number;
            delta?: number;
            color?: string;
            showLabel?: boolean;
          }

          export function StatBar({
            statName,
            value,
            maxValue = 100,
            delta,
            color = 'bg-blue-500',
            showLabel = true
          }: StatBarProps) {
            const percentage = Math.max(0, Math.min(100, (value / maxValue) * 100));

            return (
              <div className="flex flex-col gap-1 w-full mb-2">
                {showLabel && (
                  <div className="flex justify-between text-xs font-inter text-slate-300">
                    <span className="capitalize">{statName.replace('_', ' ')}</span>
                    <span className="font-mono">{Math.round(value)}/{maxValue}</span>
                  </div>
                )}
                <div className="relative w-full h-3 bg-slate-800 rounded-full overflow-hidden border border-slate-700">
                  <div 
                    className={`h-full ${color} transition-all duration-300 ease-in-out`}
                    style={{ width: `${percentage}%` }}
                  />
                </div>
                {delta !== undefined && delta !== 0 && (
                  <span className={`text-xs ${delta > 0 ? 'text-green-400' : 'text-red-400'} animate-pulse`}>
                    {delta > 0 ? '+' : ''}{delta}
                  </span>
                )}
              </div>
            );
          }
          EOF

      - name: Populate ChoiceButton Component (Task 1.5)
        run: |
          cat << 'EOF' > src/components/game/ChoiceButton.tsx
          import React from 'react';
          import type { Choice } from '../../types';

          interface ChoiceButtonProps {
            choice: Choice;
            onSelect: (choice: Choice) => void;
            disabled?: boolean;
          }

          export function ChoiceButton({ choice, onSelect, disabled = false }: ChoiceButtonProps) {
            return (
              <button
                onClick={() => onSelect(choice)}
                disabled={disabled}
                className={`w-full text-left p-4 rounded-lg border-2 transition-all duration-200 
                  ${disabled 
                    ? 'border-slate-800 bg-slate-900 text-slate-500 opacity-50 cursor-not-allowed' 
                    : 'border-slate-700 bg-slate-800 text-slate-200 hover:border-blue-500 hover:bg-slate-700 active:scale-[0.98]'
                  } flex flex-col gap-2`}
              >
                <span className="font-inter text-sm md:text-base leading-relaxed">{choice.text}</span>
              </button>
            );
          }
          EOF

      - name: Populate EventCard Component (Task 1.4)
        run: |
          cat << 'EOF' > src/components/game/EventCard.tsx
          import React from 'react';
          import type { Event, LifeStage } from '../../types';
          import { ChoiceButton } from './ChoiceButton';

          interface EventCardProps {
            event: Event;
            currentAge: number;
            currentStage: LifeStage;
            onChoiceSelect: (choiceIndex: number) => void;
          }

          export function EventCard({ event, currentAge, currentStage, onChoiceSelect }: EventCardProps) {
            return (
              <div className="w-full max-w-2xl mx-auto bg-[#1a1a1c] border border-[#3a3a3d] rounded-xl p-6 shadow-xl flex flex-col gap-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div className="flex justify-between items-center border-b border-[#3a3a3d] pb-4">
                  <h2 className="text-2xl font-medium font-lora text-[#f5f5f0]">{event.title}</h2>
                  <div className="flex items-center gap-2">
                    <span className="px-3 py-1 bg-slate-800 text-slate-300 font-mono text-sm rounded-full border border-slate-700">
                      Age {currentAge}
                    </span>
                  </div>
                </div>
                
                <div className="prose prose-invert max-w-none">
                  <p className="text-lg font-lora text-[#e5e5e0] leading-relaxed">
                    {event.narrative}
                  </p>
                </div>

                <div className="flex flex-col gap-3 mt-4">
                  {event.choices.map((choice, index) => (
                    <ChoiceButton 
                      key={index} 
                      choice={choice} 
                      onSelect={() => onChoiceSelect(index)} 
                    />
                  ))}
                </div>
              </div>
            );
          }
          EOF

      - name: Commit and Push Updates
        run: |
          git config --global user.name "GitHub Actions Builder"
          git config --global user.email "actions@github.com"
          git add src/components/game/StatBar.tsx src/components/game/ChoiceButton.tsx src/components/game/EventCard.tsx
          git commit -m "Injected Task 1.4 and 1.5 UI components"
          git push
